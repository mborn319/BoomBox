<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/js/lib.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/js/lib.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// lib.js - this is a short library of useful functions, primarily Ajax.

var Lib = function() {
  var self = this;

  /**
   * selectParent()
   * similar to jquery's closest() function,
   * the difference being that we are not chainable.
   * @param {Node} el - the element which has parents
   * @param {string} parentSelector - the CSS-style selector which will identify the parents we are searching for
   * @return {Node|boolean} An HTML node if if matches the parentSelector. Else false.
   */
  this.selectParent = function(el, parentSelector) {
    var matchesSelector = el.matches ||
                          el.webkitMatchesSelector ||
                          el.mozMatchesSelector ||
													el.msMatchesSelector;

    while (el) {
			// this loop traverses through the element's parent nodes
			if (matchesSelector.call(el, parentSelector)) {
				// if it's a match, quit and return true.
				break;
			}
			el = el.parentElement;
    }

    return el;
  };

  /**
   * template()
   * do Mustache-style templating on a string.
   * Note this is SUPER basic. Does not do nesting, loops, conditionals, etc.
   * Just simple {name}-value replacement.
   * @param {string} str - the string to search/replace IN
   * @param {Object} data - a flat object of key/value pairs to insert into the HTML string.
   * @returns {string} a full HTML with no more {key} blocks unless the corresponding data[key] did not exist.
   */
  this.template = function(str, data) {
    var retstr = str;

    // loop over all data properties
    for (var prop in data) {
      // create a regex searcher for {prop}
      var regex = new RegExp('\{'+prop+'\}','ig');
      //console.log("lib.js/template(): regex",regex);
      
      // update string
      retstr = retstr.replace(regex,data[prop]);
    }
    return retstr;
  };

  /** toDom()
   * convert a string into a fully build nodeList
   * @param {string} str - the string of correctly-formatted HTML
   * @return {NodeList} the HTML list of nodes
   */
  this.toDom = function(str) {
    var tmp = document.createElement("div");
    tmp.innerHTML = str;
    return tmp.childNodes;
  };

  /**
   * serialize()
   * take an object, output a string fit for the querystring.
   * @param {object} obj - the data object we wish to serialize.
   * @cite: http://stackoverflow.com/a/1714899/1525594
  */
  this.serialize = function(obj) {
    var str = [];
    for(var p in obj)
      if (obj.hasOwnProperty(p)) {
        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
      }
    return str.join("&amp;");
  };

  /**
   * a native Javascript ajax function.
   * Wraps XMLHttpRequest() with a url, data object, and a nice little callback.
   * @param {string} url - HTTP url to send request to
   * @param {Object} data - key/value pairs of GET or POST-type values to send
   * @param {ajaxResponse} callback - gets called with response from request
   * @param {string} method - one of "GET" or "POST"
   */
  this.ajax = function(url,data,callback,method) {
    var reqBody = '',
        reqBoundary,
        reqMethod = method ? method : "GET";//method is GET by default
        data = data ? data : {}; // data object is empty object by default

    // parameter validation
    if (!url) { throw "lib.js/ajax(): Url is required."; }
    if (!callback) { throw "lib.js/ajax(): Callback is required."; }

    var myCallback = function(e) {
      //console.log("lib.js/ajax(): Ajax request completed!",arguments);
      callback(e.target.response,e.target);
    };

    var myRequest = new XMLHttpRequest();
    myRequest.responseType = "json";
    myRequest.addEventListener("load",myCallback);

    if (reqMethod === "POST") {
      myRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
      reqBody = addFormData();
    } else if (reqMethod === "GET") {
      url = url + "?" + self.serialize(data);
    }

    // open the connection, send the data
    myRequest.open(reqMethod,url);
    myRequest.send(data);
  };

  return this;
};
lib = new Lib();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Api.html">Api</a></li><li><a href="Playlist.html">Playlist</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ajax">ajax</a></li><li><a href="global.html#collateResults">collateResults</a></li><li><a href="global.html#getCleanFilename">getCleanFilename</a></li><li><a href="global.html#getTrackFilename">getTrackFilename</a></li><li><a href="global.html#getTrackNumLeadingZero">getTrackNumLeadingZero</a></li><li><a href="global.html#getUniqueDirectory">getUniqueDirectory</a></li><li><a href="global.html#saveToMongo">saveToMongo</a></li><li><a href="global.html#selectParent">selectParent</a></li><li><a href="global.html#serialize">serialize</a></li><li><a href="global.html#template">template</a></li><li><a href="global.html#toDom">toDom</a></li><li><a href="global.html#useAudioMeta">useAudioMeta</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Mon Nov 28 2016 21:36:22 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
