var ApiInterface=function(){var a=this;this.songs={},this.albums={},this.artists={},this.stream={},this.stream.track={},this.stream.album={},this.stream.artist={},this.getTracks=function(a,b){var c=a;lib.ajax("/api/v1/track",c,b)},this.insertTracks=function(a){},this.getAlbums=function(a,b){var c=a;lib.ajax("/api/v1/album",c,b)},this.getArtists=function(a,b){var c=a;lib.ajax("/api/v1/artist",c,b)},this.pauseStream=function(a){lib.ajax("/api/v1/stream/pause",{},a)},this.playStream=function(a,b,c){var d=["track","album","artist"];if(-1==d.indexOf(a))throw"Stream play type must be one of: "+d;if("function"!=typeof c)throw"Callback is required.";var e="/api/v1/stream/"+a+"/"+b;lib.ajax(e,{},c)},this.playTrack=function(b,c){a.stream.play("track",b,c)},this.playAlbum=function(b,c){a.stream.play("album",b,c)},this.playArtist=function(b,c){a.stream.play("artist",b,c)},this.playNext=function(a){var b="/api/v1/stream/next";lib.ajax(b,{},a)},this.playPrev=function(a){var b="/api/v1/stream/prev";lib.ajax(b,{},a)}},api=new ApiInterface,Lib=function(){var a=this;return this.selectParent=function(a,b){for(var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a&&!c.call(a,b);)a=a.parentElement;return a},this.template=function(a,b){var c=a;for(var d in b){var e=new RegExp("{"+d+"}","ig");c=c.replace(e,b[d])}return c},this.toDom=function(a){var b=document.createElement("div");return b.innerHTML=a,b.childNodes},this.serialize=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},this.ajax=function(b,c,d,e){var f="",g=e?e:"GET";if(c=c?c:{},!b)throw"lib.js/ajax(): Url is required.";if(!d)throw"lib.js/ajax(): Callback is required.";var h=function(a){d(a.target.response,a.target)},i=new XMLHttpRequest;i.responseType="json",i.addEventListener("load",h),"POST"===g?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),f=addFormData()):"GET"===g&&(b=b+"?"+a.serialize(c)),i.open(g,b),i.send(c)},this};lib=new Lib,App=function(){var a=this;this.artists=!1,this.albums=!1,this.tracks=!1,this.controls={},this.foot={},this.init=function(){var a=this;a.socket=new WebSocket("wss://"+location.host),a.socket.onopen=function(a){},a.socket.onmessage=function(b){var c=JSON.parse(b.data);switch(console.log("received message from websocket connection!",c),c.type){case"playevent":a.setState(c.playstate),a.foot.update()}},a.loadFromLS(),a.controls.prev.addEventListener("click",a.controls.onPrev),a.controls.next.addEventListener("click",a.controls.onNext),a.controls.play.addEventListener("click",a.controls.onPlay)},this.getAlbumById=function(b){return a.albums.find(function(a){return a._id===b})},this.getArtistById=function(b){return a.artists.find(function(a){return a._id===b})},this.getTrackById=function(b){return a.tracks.find(function(a){return a._id===b})},this.loadFromLS=function(){"object"!=typeof window.localStorage?console.warn("Browser does not support local storage."):(localStorage.getItem("tracks")&&(a.tracks=JSON.parse(localStorage.getItem("tracks"))),localStorage.getItem("artists")&&(a.artists=JSON.parse(localStorage.getItem("artists"))),localStorage.getItem("albums")&&(a.albums=JSON.parse(localStorage.getItem("albums"))))},this.state={playing:!1,prev:!1,next:!1},this.setState=function(b){return a.state=b,a.state.artist=!1,a.state.album=!1,a.state.track.artistid&&a.artists&&(a.state.artist=a.artists.find(function(b){return b._id===a.state.track.artistid})),a.state.track.albumid&&a.albums&&(a.state.album=a.albums.find(function(b){return b._id===a.state.track.albumid})),a.state},this.controls.prev=document.getElementById("control__playprev"),this.controls.next=document.getElementById("control__playnext"),this.controls.play=document.getElementById("control__playbtn"),this.controls.onPlay=function(b){b.preventDefault(),a.state.playing?api.pauseStream(a.controls.playResponse):api.playTrack(a.state.track._id,a.controls.playResponse)},this.controls.playResponse=function(b){b.error?(console.warn("Error, couldn't find item!",b),alert("Error! Could not find item")):(console.log("playing:",b),a.foot.open())},this.controls.onPrev=function(b){b.preventDefault(),a.state.prev&&api.playPrev(a.controls.playResponse)},this.controls.onNext=function(b){b.preventDefault(),a.state.next&&api.playNext(a.controls.playResponse)},this.foot.trackEl=document.querySelector(".playing__track__title"),this.foot.artistEl=document.querySelector(".playing__track__artist"),this.foot.albumEl=document.querySelector(".playing__track__album"),this.foot.update=function(){var b=a.controls.play.querySelector(".fa");a.foot.trackEl.innerHTML=a.state.track.title,a.foot.artistEl.innerHTML=a.state.artist.name,a.foot.albumEl.innerHTML=a.state.album.title,a.state.next?a.controls.next.classList.remove("disabled"):a.controls.next.classList.add("disabled"),a.state.prev?a.controls.prev.classList.remove("disabled"):a.controls.prev.classList.add("disabled"),a.state.playing?(b.classList.remove("fa-play"),b.classList.add("fa-pause")):(b.classList.add("fa-play"),b.classList.remove("fa-pause"))},this.foot.open=function(){document.body.classList.add("open-footer")},this.init()};var app=new App,settingsBtn=document.getElementById("btnSettings"),searchBtn=document.getElementById("btnSearch"),songTab=document.getElementById("tab__songs"),artistTab=document.getElementById("tab__artists"),albumTab=document.getElementById("tab__albums"),statusBar=document.getElementById("app-statusbar"),songTabClick=function(a){a.preventDefault(),app.tracks?loadSongs(app.tracks):api.getTracks({},loadSongs),statusBar.innerHTML="",albumTab.classList.remove("active"),artistTab.classList.remove("active"),songTab.classList.add("active")},albumTabClick=function(a){a.preventDefault(),app.albums?loadAlbums(app.albums):api.getAlbums({},loadAlbums),statusBar.innerHTML="",songTab.classList.remove("active"),artistTab.classList.remove("active"),albumTab.classList.add("active")},artistTabClick=function(a){a.preventDefault(),app.artists?loadArtists(app.artists):api.getArtists({},loadArtists),statusBar.innerHTML="",songTab.classList.remove("active"),albumTab.classList.remove("active"),artistTab.classList.add("active")},dataBox=document.getElementById("app-data"),openSettings=function(){document.getElementById("app-settings").classList.toggle("open")};settingsBtn.addEventListener("click",openSettings),songTab.addEventListener("click",songTabClick),albumTab.addEventListener("click",albumTabClick),artistTab.addEventListener("click",artistTabClick),document.getElementById("clear__cache").addEventListener("click",function(a){"undefined"!=typeof window.localStorage&&(app.albums=!1,app.artists=!1,app.tracks=!1,window.localStorage.clear()),a.preventDefault()});var loadSongs=function(a){var b='<div class="list-item" id="{_id}" data-type="track"><div class="track__info"><h4 class="title">{title}</h4><h5 class="artist__name">{artistname}</h5></div><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';if(app.tracks=a,!a[0].artistname&&app.artists.length)for(var c=0;c<a.length;c++)thisArtist=app.getArtistById(a[c].artistid),thisArtist&&(a[c].artistname=thisArtist.name);return"object"==typeof window.localStorage&&localStorage.setItem("tracks",JSON.stringify(a)),loadItems(a,b)},loadArtists=function(a){var b='<div class="list-item item__artist" id="{_id}" data-type="artist"><h4 class="title">{name}</h4><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';return app.artists=a,"object"==typeof window.localStorage&&localStorage.setItem("artists",JSON.stringify(a)),loadItems(a,b)},loadAlbums=function(a){var b='<div class="list-item item__album" id="{_id}" data-type="album"><h4 class="title">{title}</h4><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';return app.albums=a,"object"==typeof window.localStorage&&localStorage.setItem("albums",JSON.stringify(a)),loadItems(a,b)},loadItems=function(a,b){dataBox.innerHTML="";for(var c=0;c<a.length;c++){var d=lib.toDom(lib.template(b,a[c]));dataBox.appendChild(d[0]);new mediaItem(document.getElementById(a[c]._id))}},mediaItem=function(a){var b=this,c=a.querySelector(".fa");return this.clearBtns=function(){var a=document.querySelector(".fa.fa-pause");a&&(a.classList.remove("fa-pause"),a.classList.add("fa-play"))},this.play=function(d){switch(b.clearBtns(),a.classList.add("active"),c.classList.remove("fa-play"),c.classList.add("fa-pause"),a.dataset.type){case"album":api.playAlbum(a.id,app.controls.playResponse);break;case"artist":api.playArtist(a.id,app.controls.playResponse);break;case"track":api.playTrack(a.id,app.controls.playResponse)}},this.pause=function(b){a.classList.remove("active"),c.classList.add("fa-play"),c.classList.remove("fa-pause"),api.pauseStream(a.id,function(){console.log("Whoa... it's paused!?",arguments)})},this.toggle=function(c){a.classList.contains("active")?b.pause(c):b.play(c)},a.querySelector(".playBtn").addEventListener("click",b.toggle),this},loadSongsByX=function(a){var b=lib.selectParent(a.target,".item__album"),c=lib.selectParent(a.target,".item__artist");b?b&&loadSongsByAlbum(b.id):c&&c&&loadSongsByArtist(c.id)};loadSongsByAlbum=function(a){var b=app.getAlbumById(a),c="<h2>{album}</h2><h4>by {artist}</h4>",d={album:b.title,artist:app.getArtistById(b.artistid).name};statusBar.innerHTML=lib.template(c,d),opts={albumid:a},api.getTracks(opts,loadSongs)},loadSongsByArtist=function(a){var b=app.getArtistById(a);artistTitle="<h2>"+b.name+"</h2>",statusBar.innerHTML=artistTitle,opts={artistid:a},api.getTracks(opts,loadSongs)},songTab.click(),window.addEventListener("click",loadSongsByX);
//# sourceMappingURL=app.min.js.map