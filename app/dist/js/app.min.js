var Api=function(){var a=this;a.songs={},a.albums={},a.artists={},a.stream={},a.stream.track={},a.stream.album={},a.stream.artist={},a.songs.get=function(a,b){var c=a;lib.ajax("/api/v1/track",c,b)},a.songs.insert=function(a){},a.albums.get=function(a,b){var c=a;lib.ajax("/api/v1/album",c,b)},a.artists.get=function(a,b){var c=a;lib.ajax("/api/v1/artist",c,b)},a.stream.pause=function(a){lib.ajax("/api/v1/stream/pause",{},a)},a.stream.play=function(a,b,c){var d=["track","album","artist"];if(-1==d.indexOf(a))throw"Stream play type must be one of: "+d;if("function"!=typeof c)throw"Callback is required.";var e="/api/v1/stream/"+a+"/"+b;lib.ajax(e,{},c)},a.stream.track.play=function(b,c){a.stream.play("track",b,c)},a.stream.album.play=function(b,c){a.stream.play("album",b,c)},a.stream.artist.play=function(b,c){a.stream.play("artist",b,c)},a.stream.next=function(a){var b="/api/v1/stream/next";lib.ajax(b,{},a)},a.stream.prev=function(a){var b="/api/v1/stream/prev";lib.ajax(b,{},a)}},api=new Api,Lib=function(){var a=this;return this.selectParent=function(a,b){for(var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a&&!c.call(a,b);)a=a.parentElement;return a},this.template=function(a,b){var c=a;for(var d in b){var e=new RegExp("{"+d+"}","ig");c=c.replace(e,b[d])}return c},this.toDom=function(a){var b=document.createElement("div");return b.innerHTML=a,b.childNodes},this.serialize=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},this.ajax=function(b,c,d,e){var f="",g=e?e:"GET";if(c=c?c:{},!b)throw"lib.js/ajax(): Url is required.";if(!d)throw"lib.js/ajax(): Callback is required.";var h=function(a){d(a.target.response,a.target)},i=new XMLHttpRequest;i.responseType="json",i.addEventListener("load",h),"POST"===g?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),f=addFormData()):"GET"===g&&(b=b+"?"+a.serialize(c)),i.open(g,b),i.send(c)},this};lib=new Lib,app={artists:!1,albums:!1,tracks:!1,init:function(){var a=this;return app.socket=new WebSocket("wss://"+location.host),app.socket.onopen=function(a){},app.socket.onmessage=function(a){var b=JSON.parse(a.data);switch(console.log("received message from websocket connection!",b),b.type){case"playevent":app.setState(b.playstate),app.foot.update()}},a.loadFromLS(),a.controls.prev.addEventListener("click",a.controls.onPrev),a.controls.next.addEventListener("click",a.controls.onNext),a.controls.play.addEventListener("click",a.controls.onPlay),this},getAlbumById:function(a){return app.albums.find(function(b){return b._id===a})},getArtistById:function(a){return app.artists.find(function(b){return b._id===a})},getTrackById:function(a){return app.tracks.find(function(b){return b._id===a})},loadFromLS:function(){"object"!=typeof window.localStorage?console.warn("Browser does not support local storage."):(localStorage.getItem("tracks")&&(app.tracks=JSON.parse(localStorage.getItem("tracks"))),localStorage.getItem("artists")&&(app.artists=JSON.parse(localStorage.getItem("artists"))),localStorage.getItem("albums")&&(app.albums=JSON.parse(localStorage.getItem("albums"))))},state:{playing:!1,prev:!1,next:!1},setState:function(a){return app.state=a,app.state.artist=!1,app.state.album=!1,app.state.track.artistid&&app.artists&&(app.state.artist=app.artists.find(function(a){return a._id===app.state.track.artistid})),app.state.track.albumid&&app.albums&&(app.state.album=app.albums.find(function(a){return a._id===app.state.track.albumid})),app.state}},app.controls={prev:document.getElementById("control__playprev"),next:document.getElementById("control__playnext"),play:document.getElementById("control__playbtn"),onPrev:function(a){a.preventDefault(),app.state.prev&&api.stream.prev(app.controls.playResponse)},onNext:function(a){a.preventDefault(),app.state.next&&api.stream.next(app.controls.playResponse)},onPlay:function(a){a.preventDefault(),app.state.playing?api.stream.pause(app.controls.playResponse):api.stream.track.play(app.state.track._id,app.controls.playResponse)},playResponse:function(a){a.error?(console.warn("Error, couldn't find item!",a),alert("Error! Could not find item")):(console.log("playing:",a),app.foot.open())}},app.foot={trackEl:document.querySelector(".playing__track__title"),artistEl:document.querySelector(".playing__track__artist"),albumEl:document.querySelector(".playing__track__album"),update:function(){var a=app.controls.play.querySelector(".fa");app.foot.trackEl.innerHTML=app.state.track.title,app.foot.artistEl.innerHTML=app.state.artist.name,app.foot.albumEl.innerHTML=app.state.album.title,app.state.next?app.controls.next.classList.remove("disabled"):app.controls.next.classList.add("disabled"),app.state.prev?app.controls.prev.classList.remove("disabled"):app.controls.prev.classList.add("disabled"),app.state.playing?(a.classList.remove("fa-play"),a.classList.add("fa-pause")):(a.classList.add("fa-play"),a.classList.remove("fa-pause"))},open:function(){document.body.classList.add("open-footer")}},app.init();var settingsBtn=document.getElementById("btnSettings"),searchBtn=document.getElementById("btnSearch"),songTab=document.getElementById("tab__songs"),artistTab=document.getElementById("tab__artists"),albumTab=document.getElementById("tab__albums"),statusBar=document.getElementById("app-statusbar"),songTabClick=function(a){a.preventDefault(),app.tracks?loadSongs(app.tracks):api.songs.get({},loadSongs),statusBar.innerHTML="",albumTab.classList.remove("active"),artistTab.classList.remove("active"),songTab.classList.add("active")},albumTabClick=function(a){a.preventDefault(),app.albums?loadAlbums(app.albums):api.albums.get({},loadAlbums),statusBar.innerHTML="",songTab.classList.remove("active"),artistTab.classList.remove("active"),albumTab.classList.add("active")},artistTabClick=function(a){a.preventDefault(),app.artists?loadArtists(app.artists):api.artists.get({},loadArtists),statusBar.innerHTML="",songTab.classList.remove("active"),albumTab.classList.remove("active"),artistTab.classList.add("active")},dataBox=document.getElementById("app-data"),openSettings=function(){document.getElementById("app-settings").classList.toggle("open")};settingsBtn.addEventListener("click",openSettings),songTab.addEventListener("click",songTabClick),albumTab.addEventListener("click",albumTabClick),artistTab.addEventListener("click",artistTabClick),document.getElementById("clear__cache").addEventListener("click",function(a){"undefined"!=typeof window.localStorage&&(app.albums=!1,app.artists=!1,app.tracks=!1,window.localStorage.clear()),a.preventDefault()});var loadSongs=function(a){var b='<div class="list-item" id="{_id}" data-type="track"><div class="track__info"><h4 class="title">{title}</h4><h5 class="artist__name">{artistname}</h5></div><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';if(app.tracks=a,!a[0].artistname&&app.artists.length)for(var c=0;c<a.length;c++)thisArtist=app.getArtistById(a[c].artistid),thisArtist&&(a[c].artistname=thisArtist.name);return"object"==typeof window.localStorage&&localStorage.setItem("tracks",JSON.stringify(a)),loadItems(a,b)},loadArtists=function(a){var b='<div class="list-item item__artist" id="{_id}" data-type="artist"><h4 class="title">{name}</h4><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';return app.artists=a,"object"==typeof window.localStorage&&localStorage.setItem("artists",JSON.stringify(a)),loadItems(a,b)},loadAlbums=function(a){var b='<div class="list-item item__album" id="{_id}" data-type="album"><h4 class="title">{title}</h4><div class="song-controls"><button class="playBtn"><span class="fa fa-play"></button></div></div>';return app.albums=a,"object"==typeof window.localStorage&&localStorage.setItem("albums",JSON.stringify(a)),loadItems(a,b)},loadItems=function(a,b){dataBox.innerHTML="";for(var c=0;c<a.length;c++){var d=lib.toDom(lib.template(b,a[c]));dataBox.appendChild(d[0]);new mediaItem(document.getElementById(a[c]._id))}},mediaItem=function(a){var b=this,c=a.querySelector(".fa");return this.clearBtns=function(){var a=document.querySelector(".fa.fa-pause");a&&(a.classList.remove("fa-pause"),a.classList.add("fa-play"))},this.play=function(d){switch(b.clearBtns(),a.classList.add("active"),c.classList.remove("fa-play"),c.classList.add("fa-pause"),a.dataset.type){case"album":api.stream.album.play(a.id,app.controls.playResponse);break;case"artist":api.stream.artist.play(a.id,app.controls.playResponse);break;case"track":api.stream.track.play(a.id,app.controls.playResponse)}},this.pause=function(b){a.classList.remove("active"),c.classList.add("fa-play"),c.classList.remove("fa-pause"),api.pause(a.id,function(){console.log("Whoa... it's paused!?",arguments)})},this.toggle=function(c){a.classList.contains("active")?b.pause(c):b.play(c)},a.querySelector(".playBtn").addEventListener("click",b.toggle),this},loadSongsByX=function(a){var b=lib.selectParent(a.target,".item__album"),c=lib.selectParent(a.target,".item__artist");b?b&&loadSongsByAlbum(b.id):c&&c&&loadSongsByArtist(c.id)};loadSongsByAlbum=function(a){var b=app.getAlbumById(a),c="<h2>{album}</h2><h4>by {artist}</h4>",d={album:b.title,artist:app.getArtistById(b.artistid).name};statusBar.innerHTML=lib.template(c,d),opts={albumid:a},api.songs.get(opts,loadSongs)},loadSongsByArtist=function(a){var b=app.getArtistById(a);artistTitle="<h2>"+b.name+"</h2>",statusBar.innerHTML=artistTitle,opts={artistid:a},api.songs.get(opts,loadSongs)},songTab.click(),window.addEventListener("click",loadSongsByX);
//# sourceMappingURL=app.min.js.map